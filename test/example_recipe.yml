#!/usr/bin/env -S stimela run -l
# This is a white-belt level Stimela 2.0 processing pipeline
opts:
    log:
        dir: logs/log-{config.run.datetime}
        name: log-{info.fqname}
        nest: 2
        symlink: log

_include:
    - (tartcargo):
        - tart2ms.yml
        - tart-download-data.yml

tart-image:
    info: TART imaging using stimela

    # this recipe has some input parameters
    inputs:
        tart:
            dtype: str
            required: true
            info: "TART name (e.g. mu-udm)"
        ms:
            dtype: str
            required: true
            info: "TART measurement set"
    assign:
        api: = 'https://api.elec.ac.nz/tart/{recipe.tart}'

    steps:

        download-hdf:
            cab: tart-download-data
            params:
                api: =recipe.api
                vis: true

        create-ms:
            cab: tart2ms
            params:
                hdf: ./vis_2025-03-08_18_52_29.028055.hdf
                ms: =recipe.ms
